import{_ as N,u as G,r as x,c as S,o as M,a as X,b,d as f,e,f as A,n as L,w as R,g as I,F as B,h as H,i as O,t as V,T as Z,j as J,k as z,l as F,m as P,v as j,p as Q,q as ee,s as U,x as te,y as ne,z as le,A as ae,B as oe,C as se,D as re}from"./index-CCQAbJcJ.js";const de=["value","placeholder"],ie={class:"dropdown-content"},ce=["onClick"],ue={class:"option-text"},me={key:0,class:"selected-indicator"},pe={class:"scrollbar"},ve={class:"scrollbar-track"},he={__name:"ScrollableDropdown",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},placeholder:{type:String,default:"Chọn một tùy chọn"},maxHeight:{type:String,default:"200px"}},emits:["update:modelValue","change"],setup(v,{emit:$}){G(t=>({"0eea3d6f":v.maxHeight}));const d=v,y=$,a=x(!1),s=x(null),u=x(null),_=x(0),i=x(!1),g=S({get:()=>d.modelValue,set:t=>y("update:modelValue",t)}),D=S(()=>{if(!g.value)return"";const t=d.options.find(c=>c.value===g.value);return t?t.label:""}),T=S(()=>{if(!u.value)return{};const t=u.value.querySelector(".dropdown-content");if(!t)return{};const{scrollHeight:c,clientHeight:p}=t,k=p/c,o=Math.max(k*p,20),n=_.value/(c-p)*(p-o);return{height:`${o}px`,top:`${n}px`,display:k>=1?"none":"block"}}),w=()=>{a.value=!a.value,a.value&&J(()=>{m()})},l=t=>{g.value=t.value,y("change",t),a.value=!1},m=()=>{if(!u.value||!g.value)return;const t=u.value.querySelector(".dropdown-option.selected");if(t){const c=u.value.querySelector(".dropdown-content"),p=t.offsetTop,k=t.offsetHeight,o=c.clientHeight;p<_.value?c.scrollTop=p:p+k>_.value+o&&(c.scrollTop=p+k-o)}},r=t=>{i.value=!0;const c=t.clientY,p=_.value,k=n=>{if(!i.value)return;const h=n.clientY-c,C=u.value.querySelector(".dropdown-content"),{scrollHeight:Y,clientHeight:q}=C,K=Y-q,W=h/q;C.scrollTop=Math.max(0,Math.min(p+W*K,K))},o=()=>{i.value=!1,document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",o)},E=t=>{s.value&&!s.value.contains(t.target)&&u.value&&!u.value.contains(t.target)&&(a.value=!1)};return M(()=>{document.addEventListener("click",E)}),X(()=>{document.removeEventListener("click",E)}),(t,c)=>(f(),b("div",{class:L(["scrollable-dropdown",{open:a.value}])},[e("div",{ref_key:"trigger",ref:s,class:"dropdown-trigger",onClick:w},[e("input",{type:"text",value:D.value,placeholder:v.placeholder,readonly:"",class:L(["dropdown-input",{"has-value":g.value}])},null,10,de),e("div",{class:L(["dropdown-arrow",{open:a.value}])},c[0]||(c[0]=[e("svg",{viewBox:"0 0 24 24",class:"arrow-icon"},[e("path",{d:"M8.964 10.164C9.04758 10.0804 9.1468 10.0141 9.25602 9.96883C9.36523 9.92358 9.48229 9.90029 9.6005 9.90029C9.71871 9.90029 9.83577 9.92358 9.94498 9.96883C10.0542 10.0141 10.1534 10.0804 10.237 10.164L12 11.927L13.764 10.164C13.9339 10.0011 14.1608 9.91126 14.3962 9.91369C14.6315 9.91612 14.8565 10.0106 15.023 10.177C15.1895 10.3433 15.2842 10.5683 15.2868 10.8036C15.2894 11.039 15.1998 11.266 15.037 11.436L12.637 13.836C12.5534 13.9196 12.4542 13.9859 12.345 14.0312C12.2358 14.0764 12.1187 14.0997 12.0005 14.0997C11.8823 14.0997 11.7652 14.0764 11.656 14.0312C11.5468 13.9859 11.4476 13.9196 11.364 13.836L8.964 11.436C8.79546 11.2672 8.70079 11.0385 8.70079 10.8C8.70079 10.5615 8.79546 10.3327 8.964 10.164Z",fill:"#464661"})],-1)]),2)],512),A(Z,{name:"dropdown"},{default:R(()=>[a.value?(f(),b("div",{key:0,ref_key:"menu",ref:u,class:"dropdown-menu"},[e("div",ie,[(f(!0),b(B,null,H(v.options,p=>(f(),b("div",{key:p.value,class:L(["dropdown-option",{selected:p.value===g.value,nested:p.level>0}]),style:O({paddingLeft:`${(p.level||0)*20}px`}),onClick:k=>l(p)},[e("span",ue,V(p.label),1),p.value===g.value?(f(),b("span",me,"✓")):I("",!0)],14,ce))),128))]),e("div",pe,[e("div",ve,[e("div",{class:"scrollbar-thumb",style:O(T.value),onMousedown:r},null,36)])])],512)):I("",!0)]),_:1})],2))}},fe=N(he,[["__scopeId","data-v-4c949797"]]),ge={class:"department-form"},be={class:"form-field"},ye={key:0,class:"error-message"},_e={class:"form-field"},xe={class:"form-field"},Te={class:"form-actions"},ke=["disabled"],De={__name:"DepartmentForm",props:{editData:{type:Object,default:null},departmentTree:{type:Array,default:()=>[]},parentOptions:{type:Array,default:()=>[{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]}},emits:["submit","cancel"],setup(v,{emit:$}){var c,p,k;const d=v,y=$,a=z({name:((c=d.editData)==null?void 0:c.name)||"",parentId:((p=d.editData)==null?void 0:p.parentId)||null,description:((k=d.editData)==null?void 0:k.description)||""}),s=z({name:null}),u=x(!1),_=S(()=>a.name.trim().length>0&&!s.name),i=(o,n=0)=>{if(!Array.isArray(o))return[];const h=[];for(const C of o)h.push({value:C.id,label:C.name||String(C.id),level:n}),C.children&&C.children.length&&h.push(...i(C.children,n+1));return h},g=S(()=>Array.isArray(d.departmentTree)&&d.departmentTree.length?[{value:null,label:"Danh mục gốc",level:0},...i(d.departmentTree,1)]:d.parentOptions);F(()=>d.editData,o=>{o?Object.assign(a,{name:o.name||"",parentId:o.parentId??null,description:o.description||""}):Object.assign(a,{name:"",parentId:null,description:""}),Object.keys(s).forEach(n=>{s[n]=null})},{immediate:!0});const D={name:{required:!0,minLength:2,maxLength:100}},T=o=>{const n=D[o],h=a[o];return o==="name"?n.required&&(!h||h.trim().length===0)?(s.name="Tên là trường bắt buộc",!1):h&&h.trim().length<n.minLength?(s.name=`Tên phải có ít nhất ${n.minLength} ký tự`,!1):h&&h.length>n.maxLength?(s.name=`Tên không được vượt quá ${n.maxLength} ký tự`,!1):(s.name=null,!0):!0},w=()=>{let o=!0;return Object.keys(D).forEach(n=>{T(n)||(o=!1)}),o},l=o=>{s[o]&&(s[o]=null)},m=o=>{},r=async()=>{var o;if(w()){u.value=!0;try{const n={...a,id:((o=d.editData)==null?void 0:o.id)||null};await y("submit",n),d.editData||t()}catch(n){console.error("Form submission error:",n)}finally{u.value=!1}}},E=()=>{d.editData?Object.assign(a,{name:d.editData.name||"",parentId:d.editData.parentId||null,description:d.editData.description||""}):t(),Object.keys(s).forEach(o=>{s[o]=null}),y("cancel")},t=()=>{Object.assign(a,{name:"",parentId:null,description:""})};return(o,n)=>(f(),b("div",ge,[n[8]||(n[8]=e("div",{class:"form-header"},[e("h2",{class:"form-title"},"THÊM MỚI KHỐI, PHÒNG BAN, BỘ PHẬN")],-1)),e("form",{class:"form-content",onSubmit:Q(r,["prevent"])},[e("div",be,[n[5]||(n[5]=e("label",{class:"form-label required"}," Tên ",-1)),P(e("input",{"onUpdate:modelValue":n[0]||(n[0]=h=>a.name=h),type:"text",class:L(["form-input",{error:s.name}]),placeholder:"Nhập tên khối, phòng ban, bộ phận muốn thêm mới",onBlur:n[1]||(n[1]=h=>T("name")),onInput:n[2]||(n[2]=h=>l("name"))},null,34),[[j,a.name]]),s.name?(f(),b("div",ye,V(s.name),1)):I("",!0)]),e("div",_e,[n[6]||(n[6]=e("label",{class:"form-label"},"Danh mục cha",-1)),A(fe,{modelValue:a.parentId,"onUpdate:modelValue":n[3]||(n[3]=h=>a.parentId=h),options:g.value,placeholder:"Danh mục gốc",onChange:m},null,8,["modelValue","options"])]),e("div",xe,[n[7]||(n[7]=e("label",{class:"form-label"},"Mô tả",-1)),P(e("textarea",{"onUpdate:modelValue":n[4]||(n[4]=h=>a.description=h),class:"form-textarea",placeholder:"Nhập nội dung",rows:"4"},null,512),[[j,a.description]])]),e("div",Te,[e("button",{type:"button",class:"btn btn-cancel",onClick:E},"XOÁ"),e("button",{type:"submit",class:"btn btn-save",disabled:u.value||!_.value},V(u.value?"ĐANG LƯU...":"LƯU"),9,ke)])],32)]))}},$e=N(De,[["__scopeId","data-v-f09d891e"]]),Ce={key:0,class:"connection-lines"},we={class:"toggle-icon"},Ee={key:2,class:"toggle-placeholder"},Le={class:"node-label"},Se={class:"node-text"},Ae={key:0,class:"node-children"},Ie={__name:"TreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0}},emits:["edit","toggle"],setup(v,{emit:$}){const d=v,y=$,a=S(()=>d.node.children&&d.node.children.length>0),s=()=>{y("toggle",d.node.id)},u=()=>{y("edit",d.node)};return(_,i)=>{const g=ee("TreeNode",!0);return f(),b("div",{class:"tree-node",style:O({"--level":v.level})},[e("div",{class:L(["node-content",{"has-children":a.value}])},[e("div",{class:"node-indent",style:O({marginLeft:`${v.level*32}px`})},[v.level>0?(f(),b("div",Ce,i[2]||(i[2]=[e("div",{class:"vertical-line"},null,-1),e("div",{class:"horizontal-line"},null,-1)]))):I("",!0),a.value?(f(),b("button",{key:1,class:L(["toggle-btn",{expanded:v.node.expanded}]),onClick:s},[e("div",we,[i[3]||(i[3]=e("div",{class:"toggle-line horizontal"},null,-1)),e("div",{class:L(["toggle-line vertical",{hidden:v.node.expanded}])},null,2)])],2)):(f(),b("div",Ee))],4),e("div",Le,[e("span",Se,V(v.node.name),1),e("button",{class:"edit-btn",onClick:u},i[4]||(i[4]=[e("span",null,"Sửa",-1)]))])],2),a.value&&v.node.expanded?(f(),b("div",Ae,[(f(!0),b(B,null,H(v.node.children,D=>(f(),U(g,{key:D.id,node:D,level:v.level+1,onEdit:i[0]||(i[0]=T=>_.$emit("edit",T)),onToggle:i[1]||(i[1]=T=>_.$emit("toggle",T))},null,8,["node","level"]))),128))])):I("",!0)],4)}}},Ne=N(Ie,[["__scopeId","data-v-7311cd11"]]),Oe={class:"tree-department"},Ve={class:"tree-container"},Me={class:"tree-content"},Be={__name:"TreeDepartment",props:{data:{type:Array,default:()=>[]}},emits:["add-department","edit-department","node-toggle"],setup(v,{emit:$}){const d=v,y=$,a=x([]),s=(l,m)=>{for(const r of m)if(l&&l[r]!==void 0&&l[r]!==null)return l[r]},u=l=>{const m=["children","child","childs","childNodes","sub","subs","items","nodes","departments","list"];for(const r of m)if(Array.isArray(l==null?void 0:l[r]))return l[r];return[]},_=l=>{const m=s(l,["code","categoryCode","value"]),r=s(l,["name","title","label","categoryName","category_name"]);return m&&r?`[${m}] - ${r}`:String(r??m??s(l,["id","_id","key"])??"Unnamed")},i=(l,m="0")=>{const r=String(s(l,["id","_id","key","value","code","categoryCode"])??`${m}`),E=u(l);return{id:r,name:_(l),expanded:!1,children:(E||[]).map((t,c)=>i(t,`${m}-${c}`))}},g=l=>Array.isArray(l)?l.map((m,r)=>i(m,String(r))):[];F(()=>d.data,l=>{a.value=g(l||[])},{immediate:!0,deep:!0});const D=l=>{y("edit-department",l)},T=l=>{w(a.value,l),y("node-toggle",l)},w=(l,m)=>{for(let r of l){if(r.id===m)return r.expanded=!r.expanded,!0;if(r.children&&r.children.length>0&&w(r.children,m))return!0}return!1};return(l,m)=>(f(),b("div",Oe,[e("div",Ve,[e("div",Me,[(f(!0),b(B,null,H(a.value,r=>(f(),U(Ne,{key:r.id,node:r,level:0,onEdit:D,onToggle:T},null,8,["node"]))),128))])])]))}},He=N(Be,[["__scopeId","data-v-2dded9cd"]]),Fe={class:"department-management"},Ue={class:"management-container"},qe={class:"left-panel"},Ke={class:"right-panel"},ze=te({__name:"IndexView",setup(v){const $=x(!1),d=x(window.innerWidth),y=x(!1);let a;const s=()=>{d.value=window.innerWidth,y.value||($.value=d.value>=768)},u=t=>{(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA")&&(y.value=t.type==="focus")};M(()=>{s(),window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(s,100)}),document.addEventListener("focus",u,!0),document.addEventListener("blur",u,!0)}),ne(()=>{document.removeEventListener("focus",u,!0),document.removeEventListener("blur",u,!0),window.removeEventListener("resize",s),clearTimeout(a)}),F(d,()=>{s()});const _=se(),i=x(null),g=x([]),D=x([{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]),T=async()=>{try{const{data:t}=await ae.get(`${oe}/categories/staff`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${_.token()}`}});g.value=t.data}catch(t){console.error("Error fetching department tree:",t)}},w=()=>{i.value=null},l=t=>{i.value=t},m=async t=>{try{await new Promise(c=>setTimeout(c,1e3)),i.value=null,alert("Lưu thành công!")}catch(c){console.error("Error saving department:",c),alert("Có lỗi xảy ra khi lưu!")}},r=()=>{i.value=null},E=t=>{};return M(()=>{T()}),(t,c)=>(f(),U(le,null,{default:R(()=>[A(re,{name:" Khối, Phòng ban, bộ phận",path:"/overtime"}),c[0]||(c[0]=e("div",{class:"font-inter hidden flex-[1] text-[20px] leading-normal font-bold text-[#464661] max-md:text-[16px] md:block"}," Danh sách bộ phận ",-1)),e("div",Fe,[e("div",Ue,[e("div",qe,[A(He,{data:g.value,onAddDepartment:w,onEditDepartment:l,onNodeToggle:E},null,8,["data"])]),e("div",Ke,[A($e,{"edit-data":i.value,"department-tree":g.value,"parent-options":D.value,onSubmit:m,onCancel:r},null,8,["edit-data","department-tree","parent-options"])])])])]),_:1}))}}),je=N(ze,[["__scopeId","data-v-5af9e6cb"]]);export{je as default};
