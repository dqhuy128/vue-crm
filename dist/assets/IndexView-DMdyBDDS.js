import{_ as H,u as Z,r as C,c as S,o as _,a as J,b as T,d as f,e as n,f as M,n as O,w as X,g as V,F as D,h as K,i as z,t as U,T as Q,j as ee,k as q,l as j,m as Y,v as W,p as te,q as ne,s as P,x as le,y as ae,z as se,A as F,B as I,C as oe,D as re}from"./index-BNwQdurt.js";const ie=["value","placeholder"],de={class:"dropdown-content"},ce=["onClick"],ue={class:"option-text"},pe={key:0,class:"selected-indicator"},me={class:"scrollbar"},ve={class:"scrollbar-track"},he={__name:"ScrollableDropdown",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},placeholder:{type:String,default:"Chọn một tùy chọn"},maxHeight:{type:String,default:"200px"}},emits:["update:modelValue","change"],setup(v,{emit:E}){Z(t=>({"0eea3d6f":v.maxHeight}));const c=v,b=E,a=C(!1),d=C(null),u=C(null),y=C(0),$=C(!1),i=S({get:()=>c.modelValue,set:t=>b("update:modelValue",t)}),L=S(()=>{if(!i.value)return"";const t=c.options.find(m=>m.value===i.value);return t?t.label:""}),w=S(()=>{if(!u.value)return{};const t=u.value.querySelector(".dropdown-content");if(!t)return{};const{scrollHeight:m,clientHeight:e}=t,o=e/m,g=Math.max(o*e,20),x=y.value/(m-e)*(e-g);return{height:`${g}px`,top:`${x}px`,display:o>=1?"none":"block"}}),k=()=>{a.value=!a.value,a.value&&ee(()=>{N()})},A=t=>{i.value=t.value,b("change",t),a.value=!1},N=()=>{if(!u.value||!i.value)return;const t=u.value.querySelector(".dropdown-option.selected");if(t){const m=u.value.querySelector(".dropdown-content"),e=t.offsetTop,o=t.offsetHeight,g=m.clientHeight;e<y.value?m.scrollTop=e:e+o>y.value+g&&(m.scrollTop=e+o-g)}},l=t=>{$.value=!0;const m=t.clientY,e=y.value,o=x=>{if(!$.value)return;const r=x.clientY-m,s=u.value.querySelector(".dropdown-content"),{scrollHeight:h,clientHeight:B}=s,R=h-B,G=r/B;s.scrollTop=Math.max(0,Math.min(e+G*R,R))},g=()=>{$.value=!1,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",g)},p=t=>{d.value&&!d.value.contains(t.target)&&u.value&&!u.value.contains(t.target)&&(a.value=!1)};return _(()=>{document.addEventListener("click",p)}),J(()=>{document.removeEventListener("click",p)}),(t,m)=>(f(),T("div",{class:O(["scrollable-dropdown",{open:a.value}])},[n("div",{ref_key:"trigger",ref:d,class:"dropdown-trigger",onClick:k},[n("input",{type:"text",value:L.value,placeholder:v.placeholder,readonly:"",class:O(["dropdown-input",{"has-value":i.value}])},null,10,ie),n("div",{class:O(["dropdown-arrow",{open:a.value}])},m[0]||(m[0]=[n("svg",{viewBox:"0 0 24 24",class:"arrow-icon"},[n("path",{d:"M8.964 10.164C9.04758 10.0804 9.1468 10.0141 9.25602 9.96883C9.36523 9.92358 9.48229 9.90029 9.6005 9.90029C9.71871 9.90029 9.83577 9.92358 9.94498 9.96883C10.0542 10.0141 10.1534 10.0804 10.237 10.164L12 11.927L13.764 10.164C13.9339 10.0011 14.1608 9.91126 14.3962 9.91369C14.6315 9.91612 14.8565 10.0106 15.023 10.177C15.1895 10.3433 15.2842 10.5683 15.2868 10.8036C15.2894 11.039 15.1998 11.266 15.037 11.436L12.637 13.836C12.5534 13.9196 12.4542 13.9859 12.345 14.0312C12.2358 14.0764 12.1187 14.0997 12.0005 14.0997C11.8823 14.0997 11.7652 14.0764 11.656 14.0312C11.5468 13.9859 11.4476 13.9196 11.364 13.836L8.964 11.436C8.79546 11.2672 8.70079 11.0385 8.70079 10.8C8.70079 10.5615 8.79546 10.3327 8.964 10.164Z",fill:"#464661"})],-1)]),2)],512),M(Q,{name:"dropdown"},{default:X(()=>[a.value?(f(),T("div",{key:0,ref_key:"menu",ref:u,class:"dropdown-menu"},[n("div",de,[(f(!0),T(D,null,K(v.options,e=>(f(),T("div",{key:e.value,class:O(["dropdown-option",{selected:e.value===i.value,nested:e.level>0}]),style:z({paddingLeft:`${(e.level||0)*20}px`}),onClick:o=>A(e)},[n("span",ue,U(e.label),1),e.value===i.value?(f(),T("span",pe,"✓")):V("",!0)],14,ce))),128))]),n("div",me,[n("div",ve,[n("div",{class:"scrollbar-thumb",style:z(w.value),onMousedown:l},null,36)])])],512)):V("",!0)]),_:1})],2))}},ge=H(he,[["__scopeId","data-v-4c949797"]]),fe={class:"department-form"},be={class:"form-field"},ye={key:0,class:"error-message"},$e={class:"form-field"},Te={class:"form-field"},ke={class:"form-actions"},Ce=["disabled"],we={__name:"DepartmentForm",props:{editData:{type:Object,default:null},departmentTree:{type:Array,default:()=>[]},parentOptions:{type:Array,default:()=>[{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]}},emits:["submit","cancel"],setup(v,{emit:E}){var e,o,g,x;const c=v,b=E,a=q({id:((e=c.editData)==null?void 0:e.id)||"",name:((o=c.editData)==null?void 0:o.name)||"",parentId:((g=c.editData)==null?void 0:g.parent_id)||null,description:((x=c.editData)==null?void 0:x.description)||"",type:"staff"}),d=q({name:null}),u=C(!1),y=S(()=>a.name.trim().length>0&&!d.name),$=S(()=>!!(c.editData&&(c.editData.id||a.id))),i=(r,s=0)=>{if(!Array.isArray(r))return[];const h=[];for(const B of r)h.push({value:B.id,label:B.name||String(B.id),level:s}),B.children&&B.children.length&&h.push(...i(B.children,s+1));return h},L=S(()=>Array.isArray(c.departmentTree)&&c.departmentTree.length?[{value:null,label:"Danh mục gốc",level:0},...i(c.departmentTree,1)]:c.parentOptions);j(()=>c.editData,r=>{r?Object.assign(a,{id:r.id||"",name:r.name||"",parentId:r.parent_id||"",description:r.description||""}):Object.assign(a,{id:"",name:"",parentId:"",description:""}),Object.keys(d).forEach(s=>{d[s]=null})},{immediate:!0,deep:!0});const w={name:{required:!0,minLength:2,maxLength:100}},k=r=>{const s=w[r],h=a[r];return r==="name"?s.required&&(!h||h.trim().length===0)?(d.name="Tên là trường bắt buộc",!1):h&&h.trim().length<s.minLength?(d.name=`Tên phải có ít nhất ${s.minLength} ký tự`,!1):h&&h.length>s.maxLength?(d.name=`Tên không được vượt quá ${s.maxLength} ký tự`,!1):(d.name=null,!0):!0},A=()=>{let r=!0;return Object.keys(w).forEach(s=>{k(s)||(r=!1)}),r},N=r=>{d[r]&&(d[r]=null)},l=r=>{a.parentId=(r==null?void 0:r.value)??null},p=async()=>{if(A()){u.value=!0;try{await b("submit",a),$.value||m()}catch(r){console.error("Form submission error:",r)}finally{u.value=!1}}},t=()=>{c.editData?Object.assign(a,{id:"",name:"",parentId:"",description:""}):m(),Object.keys(d).forEach(r=>{d[r]=null}),b("cancel")},m=()=>{Object.assign(a,{name:"",parentId:"",description:""})};return(r,s)=>(f(),T("div",fe,[s[8]||(s[8]=n("div",{class:"form-header"},[n("h2",{class:"form-title"},"THÊM MỚI KHỐI, PHÒNG BAN, BỘ PHẬN")],-1)),n("form",{class:"form-content",onSubmit:te(p,["prevent"])},[n("div",be,[s[5]||(s[5]=n("label",{class:"form-label required"}," Tên ",-1)),Y(n("input",{"onUpdate:modelValue":s[0]||(s[0]=h=>a.name=h),type:"text",class:O(["form-input",{error:d.name}]),placeholder:"Nhập tên khối, phòng ban, bộ phận muốn thêm mới",onBlur:s[1]||(s[1]=h=>k("name")),onInput:s[2]||(s[2]=h=>N("name"))},null,34),[[W,a.name]]),d.name?(f(),T("div",ye,U(d.name),1)):V("",!0)]),n("div",$e,[s[6]||(s[6]=n("label",{class:"form-label"},"Danh mục cha",-1)),M(ge,{modelValue:a.parentId,"onUpdate:modelValue":s[3]||(s[3]=h=>a.parentId=h),options:L.value,placeholder:"Danh mục gốc",onChange:l},null,8,["modelValue","options"])]),n("div",Te,[s[7]||(s[7]=n("label",{class:"form-label"},"Mô tả",-1)),Y(n("textarea",{"onUpdate:modelValue":s[4]||(s[4]=h=>a.description=h),class:"form-textarea",placeholder:"Nhập nội dung",rows:"4"},null,512),[[W,a.description]])]),n("div",ke,[n("button",{type:"button",class:"btn btn-cancel",onClick:t},"XOÁ"),n("button",{type:"submit",class:"btn btn-save",disabled:u.value||!y.value},U(u.value?"ĐANG LƯU...":$.value?"CẬP NHẬT":"LƯU"),9,Ce)])],32)]))}},xe=H(we,[["__scopeId","data-v-9fed7fdf"]]),Ee={key:0,class:"connection-lines"},Le={class:"toggle-icon"},Ae={key:2,class:"toggle-placeholder"},Be={class:"node-label"},Ne={class:"node-text"},Oe={key:0,class:"node-children"},Se={__name:"TreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0}},emits:["edit","toggle","delete"],setup(v,{emit:E}){const c=v,b=E,a=S(()=>c.node.children&&c.node.children.length>0),d=()=>{b("toggle",c.node.id)},u=()=>{b("edit",c.node.id)},y=()=>{b("delete",c.node.id)};return($,i)=>{const L=ne("TreeNode",!0);return f(),T("div",{class:"tree-node",style:z({"--level":v.level})},[n("div",{class:O(["node-content",{"has-children":a.value}])},[n("div",{class:"node-indent",style:z({marginLeft:`${v.level*32}px`})},[v.level>0?(f(),T("div",Ee,i[3]||(i[3]=[n("div",{class:"vertical-line"},null,-1),n("div",{class:"horizontal-line"},null,-1)]))):V("",!0),a.value?(f(),T("button",{key:1,class:O(["toggle-btn",{expanded:v.node.expanded}]),onClick:d},[n("div",Le,[i[4]||(i[4]=n("div",{class:"toggle-line horizontal"},null,-1)),n("div",{class:O(["toggle-line vertical",{hidden:v.node.expanded}])},null,2)])],2)):(f(),T("div",Ae))],4),n("div",Be,[n("span",Ne,U(v.node.name),1),n("button",{class:"edit-btn",onClick:u},i[5]||(i[5]=[n("span",null,"Sửa",-1)])),n("button",{class:"delete-btn",onClick:y},i[6]||(i[6]=[n("span",null,"Xóa",-1)]))])],2),a.value&&v.node.expanded?(f(),T("div",Oe,[(f(!0),T(D,null,K(v.node.children,w=>(f(),P(L,{key:w.id,node:w,level:v.level+1,onEdit:i[0]||(i[0]=k=>$.$emit("edit",k)),onToggle:i[1]||(i[1]=k=>$.$emit("toggle",k)),onDelete:i[2]||(i[2]=k=>$.$emit("delete",k))},null,8,["node","level"]))),128))])):V("",!0)],4)}}},Ie=H(Se,[["__scopeId","data-v-136ff88b"]]),Me={class:"tree-department"},Ve={class:"tree-container"},He={class:"tree-content"},Fe={__name:"TreeDepartment",props:{data:{type:Array,default:()=>[]}},emits:["add-department","edit-department","node-toggle","delete-department"],setup(v,{emit:E}){const c=v,b=E,a=C([]),d=C(new Set),u=(l,p)=>{for(const t of p)if(l&&l[t]!==void 0&&l[t]!==null)return l[t]},y=l=>{const p=["children","child","childs","childNodes","sub","subs","items","nodes","departments","list"];for(const t of p)if(Array.isArray(l==null?void 0:l[t]))return l[t];return[]},$=l=>{const p=u(l,["code","categoryCode","value"]),t=u(l,["name","title","label","categoryName","category_name"]);return p&&t?`[${p}] - ${t}`:String(t??p??u(l,["id","_id","key"])??"Unnamed")},i=(l,p="0",t)=>{const m=String(u(l,["id","_id","key","value","code","categoryCode"])??`${p}`),e=y(l);return{id:m,name:$(l),expanded:(t==null?void 0:t.has(m))||!1,children:(e||[]).map((o,g)=>i(o,`${p}-${g}`,t))}},L=(l,p)=>Array.isArray(l)?l.map((t,m)=>i(t,String(m),p)):[];j(()=>c.data,l=>{a.value=L(l||[],d.value)},{immediate:!0,deep:!0});const w=l=>{b("edit-department",l)},k=l=>{b("delete-department",l)},A=l=>{N(a.value,l),b("node-toggle",l)},N=(l,p)=>{for(let t of l){if(t.id===p)return t.expanded=!t.expanded,t.expanded?d.value.add(t.id):d.value.delete(t.id),!0;if(t.children&&t.children.length>0&&N(t.children,p))return!0}return!1};return(l,p)=>(f(),T("div",Me,[n("div",Ve,[n("div",He,[(f(!0),T(D,null,K(a.value,t=>(f(),P(Ie,{key:t.id,node:t,level:0,onEdit:w,onToggle:A,onDelete:k},null,8,["node"]))),128))])])]))}},ze=H(Fe,[["__scopeId","data-v-a05ad831"]]),Ue={class:"department-management"},_e={class:"management-container"},qe={class:"left-panel"},De={class:"right-panel"},Ke=le({__name:"IndexView",setup(v){const E=C(!1),c=C(window.innerWidth),b=C(!1);let a;const d=()=>{c.value=window.innerWidth,b.value||(E.value=c.value>=768)},u=e=>{(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA")&&(b.value=e.type==="focus")};_(()=>{d(),window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(d,100)}),document.addEventListener("focus",u,!0),document.addEventListener("blur",u,!0)}),ae(()=>{document.removeEventListener("focus",u,!0),document.removeEventListener("blur",u,!0),window.removeEventListener("resize",d),clearTimeout(a)}),j(c,()=>{d()});const y=oe(),$=C(null),i=C([]),L=C([{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]),w=async()=>{try{const{data:e}=await F.get(`${I}/categories/staff`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y.token()}`}});i.value=e.data}catch(e){console.error("Error fetching department tree:",e)}},k=()=>{},A=q({id:"",name:"",description:"",parent_id:"",type:"staff"}),N=async e=>{try{const{data:o}=await F.get(`${I}/categories/detail?id=${e}`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y.token()}`}}),{id:g,name:x,description:r,parent_id:s}=o.data;Object.assign(A,{id:g,name:x,description:r,parent_id:s})}catch(o){console.error("Error fetching department:",o)}},l=async e=>{try{const o=new FormData,g=!!(e!=null&&e.id);e!=null&&e.id&&o.append("id",e.id),e!=null&&e.type&&o.append("type",e.type),e!=null&&e.name&&o.append("name",e.name),e!=null&&e.description&&o.append("description",e.description),(e==null?void 0:e.parentId)!==void 0&&(e==null?void 0:e.parentId)!==null&&(e==null?void 0:e.parentId)!==""&&o.append("parent_id",e.parentId);const x=g?`${I}/categories/update`:`${I}/categories/create`,{status:r}=await F.post(x,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y.token()}`}});r===200&&(await w(),Object.assign(A,{id:"",name:"",description:"",parent_id:""}),$.value=null)}catch(o){console.error("Error saving department:",o)}},p=()=>{$.value=null},t=e=>{},m=async e=>{try{const o=new FormData;o.append("id",e);const{status:g}=await F.post(`${I}/categories/delete`,o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y.token()}`}});g===200&&await w()}catch(o){console.error("Error deleting department:",o)}};return _(()=>{w()}),(e,o)=>(f(),P(se,null,{default:X(()=>[M(re,{name:" Khối, Phòng ban, bộ phận",path:"/overtime"}),o[0]||(o[0]=n("div",{class:"font-inter hidden flex-[1] text-[20px] leading-normal font-bold text-[#464661] max-md:text-[16px] md:block"}," Danh sách bộ phận ",-1)),n("div",Ue,[n("div",_e,[n("div",qe,[M(ze,{data:i.value,onAddDepartment:k,onEditDepartment:N,onNodeToggle:t,onDeleteDepartment:m},null,8,["data"])]),n("div",De,[M(xe,{"edit-data":A,"department-tree":i.value,"parent-options":L.value,onSubmit:l,onCancel:p},null,8,["edit-data","department-tree","parent-options"])])])])]),_:1}))}}),Pe=H(Ke,[["__scopeId","data-v-3fcd92a0"]]);export{Pe as default};
