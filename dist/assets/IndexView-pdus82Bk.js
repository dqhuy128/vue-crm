import{_ as V,u as Z,r as T,c as I,o as F,a as J,b as y,d as g,e,f as N,n as S,w as G,g as O,F as U,h as q,i as B,t as M,T as Q,j as ee,k as H,l as A,m as j,v as R,p as te,q as ne,s as z,x as ae,y as le,z as oe,A as Y,B as W,C as se,D as re}from"./index-CqyWO-3v.js";const de=["value","placeholder"],ie={class:"dropdown-content"},ce=["onClick"],ue={class:"option-text"},me={key:0,class:"selected-indicator"},pe={class:"scrollbar"},ve={class:"scrollbar-track"},he={__name:"ScrollableDropdown",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},placeholder:{type:String,default:"Chọn một tùy chọn"},maxHeight:{type:String,default:"200px"}},emits:["update:modelValue","change"],setup(h,{emit:D}){Z(t=>({"0eea3d6f":h.maxHeight}));const d=h,_=D,i=T(!1),s=T(null),l=T(null),b=T(0),c=T(!1),f=I({get:()=>d.modelValue,set:t=>_("update:modelValue",t)}),C=I(()=>{if(!f.value)return"";const t=d.options.find(u=>u.value===f.value);return t?t.label:""}),x=I(()=>{if(!l.value)return{};const t=l.value.querySelector(".dropdown-content");if(!t)return{};const{scrollHeight:u,clientHeight:p}=t,$=p/u,k=Math.max($*p,20),a=b.value/(u-p)*(p-k);return{height:`${k}px`,top:`${a}px`,display:$>=1?"none":"block"}}),w=()=>{i.value=!i.value,i.value&&ee(()=>{m()})},n=t=>{f.value=t.value,_("change",t),i.value=!1},m=()=>{if(!l.value||!f.value)return;const t=l.value.querySelector(".dropdown-option.selected");if(t){const u=l.value.querySelector(".dropdown-content"),p=t.offsetTop,$=t.offsetHeight,k=u.clientHeight;p<b.value?u.scrollTop=p:p+$>b.value+k&&(u.scrollTop=p+$-k)}},r=t=>{c.value=!0;const u=t.clientY,p=b.value,$=a=>{if(!c.value)return;const o=a.clientY-u,v=l.value.querySelector(".dropdown-content"),{scrollHeight:L,clientHeight:K}=v,P=L-K,X=o/K;v.scrollTop=Math.max(0,Math.min(p+X*P,P))},k=()=>{c.value=!1,document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",k)};document.addEventListener("mousemove",$),document.addEventListener("mouseup",k)},E=t=>{s.value&&!s.value.contains(t.target)&&l.value&&!l.value.contains(t.target)&&(i.value=!1)};return F(()=>{document.addEventListener("click",E)}),J(()=>{document.removeEventListener("click",E)}),(t,u)=>(g(),y("div",{class:S(["scrollable-dropdown",{open:i.value}])},[e("div",{ref_key:"trigger",ref:s,class:"dropdown-trigger",onClick:w},[e("input",{type:"text",value:C.value,placeholder:h.placeholder,readonly:"",class:S(["dropdown-input",{"has-value":f.value}])},null,10,de),e("div",{class:S(["dropdown-arrow",{open:i.value}])},u[0]||(u[0]=[e("svg",{viewBox:"0 0 24 24",class:"arrow-icon"},[e("path",{d:"M8.964 10.164C9.04758 10.0804 9.1468 10.0141 9.25602 9.96883C9.36523 9.92358 9.48229 9.90029 9.6005 9.90029C9.71871 9.90029 9.83577 9.92358 9.94498 9.96883C10.0542 10.0141 10.1534 10.0804 10.237 10.164L12 11.927L13.764 10.164C13.9339 10.0011 14.1608 9.91126 14.3962 9.91369C14.6315 9.91612 14.8565 10.0106 15.023 10.177C15.1895 10.3433 15.2842 10.5683 15.2868 10.8036C15.2894 11.039 15.1998 11.266 15.037 11.436L12.637 13.836C12.5534 13.9196 12.4542 13.9859 12.345 14.0312C12.2358 14.0764 12.1187 14.0997 12.0005 14.0997C11.8823 14.0997 11.7652 14.0764 11.656 14.0312C11.5468 13.9859 11.4476 13.9196 11.364 13.836L8.964 11.436C8.79546 11.2672 8.70079 11.0385 8.70079 10.8C8.70079 10.5615 8.79546 10.3327 8.964 10.164Z",fill:"#464661"})],-1)]),2)],512),N(Q,{name:"dropdown"},{default:G(()=>[i.value?(g(),y("div",{key:0,ref_key:"menu",ref:l,class:"dropdown-menu"},[e("div",ie,[(g(!0),y(U,null,q(h.options,p=>(g(),y("div",{key:p.value,class:S(["dropdown-option",{selected:p.value===f.value,nested:p.level>0}]),style:B({paddingLeft:`${(p.level||0)*20}px`}),onClick:$=>n(p)},[e("span",ue,M(p.label),1),p.value===f.value?(g(),y("span",me,"✓")):O("",!0)],14,ce))),128))]),e("div",pe,[e("div",ve,[e("div",{class:"scrollbar-thumb",style:B(x.value),onMousedown:r},null,36)])])],512)):O("",!0)]),_:1})],2))}},fe=V(he,[["__scopeId","data-v-4c949797"]]),ge={class:"department-form"},be={class:"form-field"},ye={key:0,class:"error-message"},_e={class:"form-field"},xe={class:"form-field"},Te={class:"form-actions"},$e=["disabled"],ke={__name:"DepartmentForm",props:{editData:{type:Object,default:null},departmentTree:{type:Array,default:()=>[]},parentOptions:{type:Array,default:()=>[{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]}},emits:["submit","cancel"],setup(h,{emit:D}){var p,$,k;const d=h,_=D,i=H({type:"staff",name:"",description:"",parent_id:""}),s=H({name:((p=d.editData)==null?void 0:p.name)||"",parentId:(($=d.editData)==null?void 0:$.parentId)||null,description:((k=d.editData)==null?void 0:k.description)||""}),l=H({name:null}),b=T(!1),c=I(()=>s.name.trim().length>0&&!l.name),f=(a,o=0)=>{if(!Array.isArray(a))return[];const v=[];for(const L of a)v.push({value:L.id,label:L.name||String(L.id),level:o}),L.children&&L.children.length&&v.push(...f(L.children,o+1));return v},C=I(()=>Array.isArray(d.departmentTree)&&d.departmentTree.length?[{value:null,label:"Danh mục gốc",level:0},...f(d.departmentTree,1)]:d.parentOptions);A(()=>s.parentId,a=>{i.parent_id=a},{immediate:!0}),A(()=>s.name,a=>{i.name=a},{immediate:!0}),A(()=>s.description,a=>{i.description=a},{immediate:!0}),A(()=>d.editData,a=>{a?Object.assign(s,{name:a.name||"",parentId:a.parentId??null,description:a.description||""}):Object.assign(s,{name:"",parentId:null,description:""}),Object.keys(l).forEach(o=>{l[o]=null})},{immediate:!0});const x={name:{required:!0,minLength:2,maxLength:100}},w=a=>{const o=x[a],v=s[a];return a==="name"?o.required&&(!v||v.trim().length===0)?(l.name="Tên là trường bắt buộc",!1):v&&v.trim().length<o.minLength?(l.name=`Tên phải có ít nhất ${o.minLength} ký tự`,!1):v&&v.length>o.maxLength?(l.name=`Tên không được vượt quá ${o.maxLength} ký tự`,!1):(l.name=null,!0):!0},n=()=>{let a=!0;return Object.keys(x).forEach(o=>{w(o)||(a=!1)}),a},m=a=>{l[a]&&(l[a]=null)},r=a=>{i.parent_id=(a==null?void 0:a.value)??null},E=async()=>{if(n()){b.value=!0;try{await _("submit",i),d.editData||u()}catch(a){console.error("Form submission error:",a)}finally{b.value=!1}}},t=()=>{d.editData?Object.assign(s,{name:d.editData.name||"",parentId:d.editData.parentId||null,description:d.editData.description||""}):u(),Object.keys(l).forEach(a=>{l[a]=null}),_("cancel")},u=()=>{Object.assign(s,{name:"",parentId:null,description:""})};return(a,o)=>(g(),y("div",ge,[o[8]||(o[8]=e("div",{class:"form-header"},[e("h2",{class:"form-title"},"THÊM MỚI KHỐI, PHÒNG BAN, BỘ PHẬN")],-1)),e("form",{class:"form-content",onSubmit:te(E,["prevent"])},[e("div",be,[o[5]||(o[5]=e("label",{class:"form-label required"}," Tên ",-1)),j(e("input",{"onUpdate:modelValue":o[0]||(o[0]=v=>s.name=v),type:"text",class:S(["form-input",{error:l.name}]),placeholder:"Nhập tên khối, phòng ban, bộ phận muốn thêm mới",onBlur:o[1]||(o[1]=v=>w("name")),onInput:o[2]||(o[2]=v=>m("name"))},null,34),[[R,s.name]]),l.name?(g(),y("div",ye,M(l.name),1)):O("",!0)]),e("div",_e,[o[6]||(o[6]=e("label",{class:"form-label"},"Danh mục cha",-1)),N(fe,{modelValue:s.parentId,"onUpdate:modelValue":o[3]||(o[3]=v=>s.parentId=v),options:C.value,placeholder:"Danh mục gốc",onChange:r},null,8,["modelValue","options"])]),e("div",xe,[o[7]||(o[7]=e("label",{class:"form-label"},"Mô tả",-1)),j(e("textarea",{"onUpdate:modelValue":o[4]||(o[4]=v=>s.description=v),class:"form-textarea",placeholder:"Nhập nội dung",rows:"4"},null,512),[[R,s.description]])]),e("div",Te,[e("button",{type:"button",class:"btn btn-cancel",onClick:t},"XOÁ"),e("button",{type:"submit",class:"btn btn-save",disabled:b.value||!c.value},M(b.value?"ĐANG LƯU...":"LƯU"),9,$e)])],32)]))}},Ce=V(ke,[["__scopeId","data-v-9740e02c"]]),De={key:0,class:"connection-lines"},we={class:"toggle-icon"},Ee={key:2,class:"toggle-placeholder"},Le={class:"node-label"},Se={class:"node-text"},Ae={key:0,class:"node-children"},Ie={__name:"TreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0}},emits:["edit","toggle"],setup(h,{emit:D}){const d=h,_=D,i=I(()=>d.node.children&&d.node.children.length>0),s=()=>{_("toggle",d.node.id)},l=()=>{_("edit",d.node)};return(b,c)=>{const f=ne("TreeNode",!0);return g(),y("div",{class:"tree-node",style:B({"--level":h.level})},[e("div",{class:S(["node-content",{"has-children":i.value}])},[e("div",{class:"node-indent",style:B({marginLeft:`${h.level*32}px`})},[h.level>0?(g(),y("div",De,c[2]||(c[2]=[e("div",{class:"vertical-line"},null,-1),e("div",{class:"horizontal-line"},null,-1)]))):O("",!0),i.value?(g(),y("button",{key:1,class:S(["toggle-btn",{expanded:h.node.expanded}]),onClick:s},[e("div",we,[c[3]||(c[3]=e("div",{class:"toggle-line horizontal"},null,-1)),e("div",{class:S(["toggle-line vertical",{hidden:h.node.expanded}])},null,2)])],2)):(g(),y("div",Ee))],4),e("div",Le,[e("span",Se,M(h.node.name),1),e("button",{class:"edit-btn",onClick:l},c[4]||(c[4]=[e("span",null,"Sửa",-1)]))])],2),i.value&&h.node.expanded?(g(),y("div",Ae,[(g(!0),y(U,null,q(h.node.children,C=>(g(),z(f,{key:C.id,node:C,level:h.level+1,onEdit:c[0]||(c[0]=x=>b.$emit("edit",x)),onToggle:c[1]||(c[1]=x=>b.$emit("toggle",x))},null,8,["node","level"]))),128))])):O("",!0)],4)}}},Ne=V(Ie,[["__scopeId","data-v-7311cd11"]]),Oe={class:"tree-department"},Ve={class:"tree-container"},Be={class:"tree-content"},Me={__name:"TreeDepartment",props:{data:{type:Array,default:()=>[]}},emits:["add-department","edit-department","node-toggle"],setup(h,{emit:D}){const d=h,_=D,i=T([]),s=(n,m)=>{for(const r of m)if(n&&n[r]!==void 0&&n[r]!==null)return n[r]},l=n=>{const m=["children","child","childs","childNodes","sub","subs","items","nodes","departments","list"];for(const r of m)if(Array.isArray(n==null?void 0:n[r]))return n[r];return[]},b=n=>{const m=s(n,["code","categoryCode","value"]),r=s(n,["name","title","label","categoryName","category_name"]);return m&&r?`[${m}] - ${r}`:String(r??m??s(n,["id","_id","key"])??"Unnamed")},c=(n,m="0")=>{const r=String(s(n,["id","_id","key","value","code","categoryCode"])??`${m}`),E=l(n);return{id:r,name:b(n),expanded:!1,children:(E||[]).map((t,u)=>c(t,`${m}-${u}`))}},f=n=>Array.isArray(n)?n.map((m,r)=>c(m,String(r))):[];A(()=>d.data,n=>{i.value=f(n||[])},{immediate:!0,deep:!0});const C=n=>{_("edit-department",n)},x=n=>{w(i.value,n),_("node-toggle",n)},w=(n,m)=>{for(let r of n){if(r.id===m)return r.expanded=!r.expanded,!0;if(r.children&&r.children.length>0&&w(r.children,m))return!0}return!1};return(n,m)=>(g(),y("div",Oe,[e("div",Ve,[e("div",Be,[(g(!0),y(U,null,q(i.value,r=>(g(),z(Ne,{key:r.id,node:r,level:0,onEdit:C,onToggle:x},null,8,["node"]))),128))])])]))}},He=V(Me,[["__scopeId","data-v-2dded9cd"]]),Fe={class:"department-management"},Ue={class:"management-container"},qe={class:"left-panel"},ze={class:"right-panel"},Ke=ae({__name:"IndexView",setup(h){const D=T(!1),d=T(window.innerWidth),_=T(!1);let i;const s=()=>{d.value=window.innerWidth,_.value||(D.value=d.value>=768)},l=t=>{(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA")&&(_.value=t.type==="focus")};F(()=>{s(),window.addEventListener("resize",()=>{clearTimeout(i),i=setTimeout(s,100)}),document.addEventListener("focus",l,!0),document.addEventListener("blur",l,!0)}),le(()=>{document.removeEventListener("focus",l,!0),document.removeEventListener("blur",l,!0),window.removeEventListener("resize",s),clearTimeout(i)}),A(d,()=>{s()});const b=se(),c=T(null),f=T([]),C=T([{value:null,label:"Danh mục gốc",level:0},{value:"12-1",label:"Khối điều hành",level:1},{value:"12-2",label:"DM cấp 2 - Phòng ban",level:2},{value:"12-3",label:"DM cấp 3 - Bộ phận",level:2},{value:"12-4",label:"Khối BO",level:1},{value:"12-5",label:"Khối Kinh doanh",level:1}]),x=async()=>{try{const{data:t}=await Y.get(`${W}/categories/staff`,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b.token()}`}});f.value=t.data}catch(t){console.error("Error fetching department tree:",t)}},w=()=>{c.value=null},n=t=>{c.value=t},m=async t=>{try{const{status:u}=await Y.post(`${W}/categories/create`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${b.token()}`}});u===200&&(x(),c.value=null)}catch(u){console.error("Error saving department:",u)}},r=()=>{c.value=null},E=t=>{};return F(()=>{x()}),(t,u)=>(g(),z(oe,null,{default:G(()=>[N(re,{name:" Khối, Phòng ban, bộ phận",path:"/overtime"}),u[0]||(u[0]=e("div",{class:"font-inter hidden flex-[1] text-[20px] leading-normal font-bold text-[#464661] max-md:text-[16px] md:block"}," Danh sách bộ phận ",-1)),e("div",Fe,[e("div",Ue,[e("div",qe,[N(He,{data:f.value,onAddDepartment:w,onEditDepartment:n,onNodeToggle:E},null,8,["data"])]),e("div",ze,[N(Ce,{"edit-data":c.value,"department-tree":f.value,"parent-options":C.value,onSubmit:m,onCancel:r},null,8,["edit-data","department-tree","parent-options"])])])])]),_:1}))}}),je=V(Ke,[["__scopeId","data-v-2eddde64"]]);export{je as default};
